/**
 * uasset-reader-js (v1.0.1)
 * https://github.com/blueprintue/uasset-reader-js
 * 
 * MIT License
 * 
 * Copyright (c) 2023 blueprintUE
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(){"use strict";function e(){this.currentIdx=0,this.bytes=[],this.uasset={hexView:[],header:{},names:[],gatherableTextData:[],imports:{},exports:[],depends:{},softPackageReferences:{},searchableNames:{},thumbnails:{Index:[],Thumbnails:[]},assetRegistryData:{},preloadDependency:{},bulkDataStart:{}}}void 0===window.blueprintUE&&(window.blueprintUE={}),void 0===window.blueprintUE.uasset&&(window.blueprintUE.uasset={}),e.prototype.uint16=function(e){var t=this.readCountBytes(2),t=new DataView(new Uint8Array(t).buffer).getUint16(0,!0);return this.addHexView(e,"uint16",t,this.currentIdx-2,this.currentIdx-1),t},e.prototype.int32=function(e){var t=this.readCountBytes(4),t=new DataView(new Uint8Array(t).buffer).getInt32(0,!0);return this.addHexView(e,"int32",t,this.currentIdx-4,this.currentIdx-1),t},e.prototype.uint32=function(e){var t=this.readCountBytes(4),t=new DataView(new Uint8Array(t).buffer).getUint32(0,!0);return this.addHexView(e,"uint32",t,this.currentIdx-4,this.currentIdx-1),t},e.prototype.int64=function(e){var t=this.readCountBytes(8),t=new DataView(new Uint8Array(t).buffer).getBigInt64(0,!0);return this.addHexView(e,"int64",t,this.currentIdx-8,this.currentIdx-1),t},e.prototype.uint64=function(e){var t=this.readCountBytes(8),t=new DataView(new Uint8Array(t).buffer).getBigUint64(0,!0);return this.addHexView(e,"uint64",t,this.currentIdx-8,this.currentIdx-1),t},e.prototype.fguidSlot=function(e){for(var t,s="",a="",i="",r="",n=3,h=this.readCountBytes(16);0<=n;--n)s+=h[n].toString(16).padStart(2,"0"),a+=h[n+4].toString(16).padStart(2,"0"),i+=h[n+8].toString(16).padStart(2,"0"),r+=h[n+12].toString(16).padStart(2,"0");return t=(s+a+i+r).toUpperCase(),this.addHexView(e,"fguidSlot",t,this.currentIdx-16,this.currentIdx-1),t},e.prototype.fguidString=function(e){for(var t,s="",a=0,i=this.readCountBytes(16);a<16;++a)s+=i[a].toString(16).padStart(2,"0");return t=s.toUpperCase(),this.addHexView(e,"fguidString",t,this.currentIdx-16,this.currentIdx-1),t},e.prototype.fstring=function(e){var t,s,a,i="",r=[],n="",h=0,o=[],u=0,d=(this.currentIdx,this.int32(e+" (fstring length)"));if(0===d)return"";if(a=this.currentIdx,0<d){for(r=this.readCountBytes(d),u=0;u<r.length-1;++u)n+=String.fromCharCode(r[u]);return i=n,this.addHexView(e,"fstring",i,a,this.currentIdx-1),n}for(r=this.readCountBytes(-1*d*2);h<r.length;)55296<=(t=String.fromCharCode(r[h++]))&&t<=56319&&h<r.length?56320==(64512&(s=String.fromCharCode(r[h++])))?o.push(((1023&t)<<10)+(1023&s)+65536):(o.push(t),h--):o.push(t);return i=o.join(""),this.addHexView(e,"fstring",i,a,this.currentIdx-1),i},e.prototype.readCountBytes=function(e){for(var t=[],s=0;s<e;++s)t.push(this.bytes[this.currentIdx]),this.currentIdx+=1;return t},e.prototype.addHexView=function(e,t,s,a,i){!1!==this.saveHexView&&this.uasset.hexView.push({key:e,type:t,value:s,start:a,stop:i})},e.prototype.resolveFName=function(e){return this.uasset.names[e]?this.uasset.names[e].Name:""},e.prototype.readHeader=function(){var e=0,t=0;if(this.uasset.header.EPackageFileTag=this.uint32("EPackageFileTag"),3246598814===this.uasset.header.EPackageFileTag)return new Error("invalid uasset: the package has been stored in a separate endianness");if(2653586369!==this.uasset.header.EPackageFileTag)return new Error("invalid uasset");if(this.uasset.header.LegacyFileVersion=this.int32("LegacyFileVersion"),-6!==this.uasset.header.LegacyFileVersion&&-7!==this.uasset.header.LegacyFileVersion&&-8!==this.uasset.header.LegacyFileVersion)return new Error("unsupported version");if(this.uasset.header.LegacyUE3Version=this.int32("LegacyUE3Version"),this.uasset.header.FileVersionUE4=this.int32("FileVersionUE4"),this.uasset.header.LegacyFileVersion<=-8&&(this.uasset.header.FileVersionUE5=this.int32("FileVersionUE5")),this.uasset.header.FileVersionLicenseeUE4=this.int32("FileVersionLicenseeUE4"),0===this.uasset.header.FileVersionUE4&&0===this.uasset.header.FileVersionLicenseeUE4&&0===this.uasset.header.FileVersionUE5)return new Error("asset unversioned");for(t=this.int32("CustomVersions Count"),this.uasset.header.CustomVersions=[],e=0;e<t;++e)this.uasset.header.CustomVersions.push({key:this.fguidSlot("CustomVersions #"+e+": key"),version:this.int32("CustomVersions #"+e+": version")});if(this.uasset.header.TotalHeaderSize=this.int32("TotalHeaderSize"),this.uasset.header.FolderName=this.fstring("FolderName"),this.uasset.header.PackageFlags=this.uint32("PackageFlags"),this.uasset.header.NameCount=this.int32("NameCount"),this.uasset.header.NameOffset=this.int32("NameOffset"),1008<=this.uasset.header.FileVersionUE5&&(this.uasset.header.SoftObjectPathsCount=this.uint32("SoftObjectPathsCount"),this.uasset.header.SoftObjectPathsOffset=this.uint32("SoftObjectPathsOffset")),516<=this.uasset.header.FileVersionUE4&&(this.uasset.header.LocalizationId=this.fstring("LocalizationId")),459<=this.uasset.header.FileVersionUE4&&(this.uasset.header.GatherableTextDataCount=this.int32("GatherableTextDataCount"),this.uasset.header.GatherableTextDataOffset=this.int32("GatherableTextDataOffset")),this.uasset.header.ExportCount=this.int32("ExportCount"),this.uasset.header.ExportOffset=this.int32("ExportOffset"),this.uasset.header.ImportCount=this.int32("ImportCount"),this.uasset.header.ImportOffset=this.int32("ImportOffset"),this.uasset.header.DependsOffset=this.int32("DependsOffset"),this.uasset.header.FileVersionUE4<214)return new Error("asset too old");for(384<=this.uasset.header.FileVersionUE4&&(this.uasset.header.SoftPackageReferencesCount=this.int32("SoftPackageReferencesCount"),this.uasset.header.SoftPackageReferencesOffset=this.int32("SoftPackageReferencesOffset")),510<=this.uasset.header.FileVersionUE4&&(this.uasset.header.SearchableNamesOffset=this.int32("SearchableNamesOffset")),this.uasset.header.ThumbnailTableOffset=this.int32("ThumbnailTableOffset"),this.uasset.header.Guid=this.fguidString("Guid"),518<=this.uasset.header.FileVersionUE4&&(this.uasset.header.PersistentGuid=this.fguidString("PersistentGuid")),518<=this.uasset.header.FileVersionUE4&&this.uasset.header.FileVersionUE4<520&&(this.uasset.header.OwnerPersistentGuid=this.fguidString("OwnerPersistentGuid")),t=this.int32("Generations Count"),this.uasset.header.Generations=[],e=0;e<t;++e)this.uasset.header.Generations.push({exportCount:this.int32("Generations #"+e+": export count"),nameCount:this.int32("Generations #"+e+": name count)")});if(336<=this.uasset.header.FileVersionUE4?(this.uasset.header.SavedByEngineVersion=String(this.uint16("SavedByEngineVersion Major")),this.uasset.header.SavedByEngineVersion+="."+this.uint16("SavedByEngineVersion Minor"),this.uasset.header.SavedByEngineVersion+="."+this.uint16("SavedByEngineVersion Patch"),this.uasset.header.SavedByEngineVersion+="-"+this.uint32("SavedByEngineVersion Changelist"),this.uasset.header.SavedByEngineVersion+="+"+this.fstring("SavedByEngineVersion Branch")):this.uasset.header.EngineChangelist=this.int32("EngineChangelist"),444<=this.uasset.header.FileVersionUE4?(this.uasset.header.CompatibleWithEngineVersion=String(this.uint16("CompatibleWithEngineVersion Major")),this.uasset.header.CompatibleWithEngineVersion+="."+this.uint16("CompatibleWithEngineVersion Minor"),this.uasset.header.CompatibleWithEngineVersion+="."+this.uint16("CompatibleWithEngineVersion Patch"),this.uasset.header.CompatibleWithEngineVersion+="-"+this.uint32("CompatibleWithEngineVersion Changelist"),this.uasset.header.CompatibleWithEngineVersion+="+"+this.fstring("CompatibleWithEngineVersion Branch")):this.uasset.header.CompatibleWithEngineVersion=this.uasset.header.SavedByEngineVersion,this.uasset.header.CompressionFlags=this.uint32("CompressionFlags"),0<(t=this.int32("CompressedChunks Count")))return new Error("asset compressed");if(this.uasset.header.PackageSource=this.uint32("PackageSource"),t=this.uint32("AdditionalPackagesToCook Count"),this.uasset.header.AdditionalPackagesToCook=[],0<t)return new Error("AdditionalPackagesToCook has items");if(-7<this.uasset.header.LegacyFileVersion&&(this.uasset.header.NumTextureAllocations=this.int32("NumTextureAllocations")),this.uasset.header.AssetRegistryDataOffset=this.int32("AssetRegistryDataOffset"),this.uasset.header.BulkDataStartOffset=this.int64("BulkDataStartOffset"),224<=this.uasset.header.FileVersionUE4&&(this.uasset.header.WorldTileInfoDataOffset=this.int32("WorldTileInfoDataOffset")),326<=this.uasset.header.FileVersionUE4){if(t=this.int32("ChunkIDs Count"),this.uasset.header.ChunkIDs=[],0<t)return new Error("ChunkIDs has items")}else 278<=this.uasset.header.FileVersionUE4&&(this.uasset.header.ChunkID=this.int32("ChunkID"));507<=this.uasset.header.FileVersionUE4?(this.uasset.header.PreloadDependencyCount=this.int32("PreloadDependencyCount"),this.uasset.header.PreloadDependencyOffset=this.int32("PreloadDependencyOffset")):(this.uasset.header.PreloadDependencyCount=-1,this.uasset.header.PreloadDependencyOffset=0),1001<=this.uasset.header.FileVersionUE5&&(this.uasset.header.NamesReferencedFromExportDataCount=this.int32("NamesReferencedFromExportDataCount")),1002<=this.uasset.header.FileVersionUE5?this.uasset.header.PayloadTocOffset=this.int64("PayloadTocOffset"):this.uasset.header.PayloadTocOffset=-1,1009<=this.uasset.header.FileVersionUE5&&(this.uasset.header.DataResourceOffset=this.int32("DataResourceOffset"))},e.prototype.readNames=function(){var e=0,t=this.uasset.header.NameCount;for(this.currentIdx=this.uasset.header.NameOffset;e<t;++e)this.uasset.names.push({Name:this.fstring("Name #"+(e+1)+": string"),NonCasePreservingHash:this.uint16("Name #"+(e+1)+": NonCasePreservingHash"),CasePreservingHash:this.uint16("Name #"+(e+1)+": CasePreservingHash")})},e.prototype.readGatherableTextData=function(){var e,t={},s={},a=0,i=0,r=this.uasset.header.GatherableTextDataCount;for(this.currentIdx=this.uasset.header.GatherableTextDataOffset,this.uasset.gatherableTextData=[];i<r;++i){if((t={}).NamespaceName=this.fstring("GatherableTextData #"+(i+1)+": NamespaceName"),t.SourceData={SourceString:this.fstring("GatherableTextData #"+(i+1)+": SourceData.SourceString"),SourceStringMetaData:{ValueCount:this.int32("GatherableTextData #"+(i+1)+": SourceData.CountSourceStringMetaData"),Values:[]}},0<t.SourceData.SourceStringMetaData.ValueCount)return new Error("unsupported SourceStringMetaData from readGatherableTextData");for(t.SourceSiteContexts=[],e=this.int32("GatherableTextData #"+(i+1)+": CountSourceSiteContexts"),a=0;a<e;++a){if(s.KeyName=this.fstring("GatherableTextData #"+(i+1)+" - SourceSiteContexts #"+(a+1)+": KeyName"),s.SiteDescription=this.fstring("GatherableTextData #"+(i+1)+" - SourceSiteContexts #"+(a+1)+": SiteDescription"),s.IsEditorOnly=this.uint32("GatherableTextData #"+(i+1)+" - SourceSiteContexts #"+(a+1)+": IsEditorOnly"),s.IsOptional=this.uint32("GatherableTextData #"+(i+1)+" - SourceSiteContexts #"+(a+1)+": IsOptional"),s.InfoMetaData={ValueCount:this.int32("GatherableTextData #"+(i+1)+" - SourceSiteContexts #"+(a+1)+": CountInfoMetaData"),Values:[]},0<s.InfoMetaData.ValueCount)return new Error("unsupported SourceSiteContexts.InfoMetaData from readGatherableTextData");if(s.KeyMetaData={ValueCount:this.int32("GatherableTextData #"+(i+1)+" - SourceSiteContexts #"+(a+1)+": CountKeyMetaData"),Values:[]},0<s.KeyMetaData.ValueCount)return new Error("unsupported SourceSiteContexts.KeyMetaData from readGatherableTextData");t.SourceSiteContexts.push(s)}this.uasset.gatherableTextData.push(t)}},e.prototype.readImports=function(){var e,t,s,a,i=0,r="",n=0,h=this.uasset.header.ImportCount;for(this.currentIdx=this.uasset.header.ImportOffset,this.uasset.imports.Imports=[];i<h;++i)e=this.uint64("Import #"+(i+1)+": classPackage"),t=this.uint64("Import #"+(i+1)+": className"),s=this.int32("Import #"+(i+1)+": outerIndex"),a=this.uint64("Import #"+(i+1)+": objectName"),520<=this.uasset.header.FileVersionUE4&&(r=this.uint64("Import #"+(i+1)+": packageName")),1003<=this.uasset.header.FileVersionUE5&&(n=this.int32("Import #"+(i+1)+": importOptional")),this.uasset.imports.Imports.push({classPackage:this.resolveFName(e),className:this.resolveFName(t),outerIndex:s,objectName:this.resolveFName(a),packageName:this.resolveFName(r),bImportOptional:n})},e.prototype.readExports=function(){var e,t,s,a,i,r,n,h,o,u,d,f,l,c,p=0,g=0,m=0,x=0,E=0,C=0,b=0,D=0,S=0,y=0;for(this.currentIdx=this.uasset.header.ExportOffset,e=this.uasset.header.ExportCount,this.uasset.exports=[];p<e;++p)s=this.int32("Export #"+(p+1)+": classIndex"),a=this.int32("Export #"+(p+1)+": superIndex"),508<=this.uasset.header.FileVersionUE4&&(g=this.int32("Export #"+(p+1)+": templateIndex")),i=this.int32("Export #"+(p+1)+": outerIndex"),r=this.uint64("Export #"+(p+1)+": objectName"),n=this.uint32("Export #"+(p+1)+": objectFlags"),h=this.int64("Export #"+(p+1)+": serialSize"),o=this.int64("Export #"+(p+1)+": serialOffset"),u=this.int32("Export #"+(p+1)+": bForcedExport"),d=this.int32("Export #"+(p+1)+": bNotForClient"),f=this.int32("Export #"+(p+1)+": bNotForServer"),l=this.fguidString("Export #"+(p+1)+": packageGuid"),c=this.uint32("Export #"+(p+1)+": packageFlags"),365<=this.uasset.header.FileVersionUE4&&(m=this.int32("Export #"+(p+1)+": bNotAlwaysLoadedForEditorGame")),485<=this.uasset.header.FileVersionUE4&&(x=this.int32("Export #"+(p+1)+": bIsAsset")),1003<=this.uasset.header.FileVersionUE5&&(E=this.int32("Export #"+(p+1)+": bGeneratePublicHash")),507<=this.uasset.header.FileVersionUE4&&(C=this.int32("Export #"+(p+1)+": firstExportDependency"),b=this.int32("Export #"+(p+1)+": serializationBeforeSerializationDependencies"),D=this.int32("Export #"+(p+1)+": createBeforeSerializationDependencies"),S=this.int32("Export #"+(p+1)+": serializationBeforeCreateDependencies"),y=this.int32("Export #"+(p+1)+": createBeforeCreateDependencies")),this.uasset.exports.push({classIndex:s,superIndex:a,templateIndex:g,outerIndex:i,objectName:this.resolveFName(r),objectFlags:n,serialSize:h,serialOffset:o,bForcedExport:u,bNotForClient:d,bNotForServer:f,packageGuid:l,packageFlags:c,bNotAlwaysLoadedForEditorGame:m,bIsAsset:x,bGeneratePublicHash:E,firstExportDependency:C,serializationBeforeSerializationDependencies:b,createBeforeSerializationDependencies:D,serializationBeforeCreateDependencies:S,createBeforeCreateDependencies:y,data:[]});for(p=0;p<e;++p)this.uasset.exports[p].serialSize<=0||(this.currentIdx=Number(this.uasset.exports[p].serialOffset),t=this.uint64("Exports #"+(p+1)+": data"),this.uasset.exports[p].data.push(this.resolveFName(t)),this.uasset.exports[p].data.push(this.uint32("flags")))},e.prototype.readDepends=function(){var e,t=0;for(this.currentIdx=this.uasset.header.DependsOffset,e=this.int32("Depends Count"),this.uasset.depends.Depends=[];t<e;++t)this.uasset.depends.Depends.push({FPackageIndex:this.int32("Depend #"+(t+1)+": FPackageIndex")})},e.prototype.readSoftPackageReferences=function(){var e,t,s=0;for(this.currentIdx=this.uasset.header.SoftPackageReferencesOffset,t=this.uasset.header.SoftPackageReferencesCount,this.uasset.softPackageReferences=[];s<t;++s)e=this.uint64("SoftPackageReferences #"+(s+1)+": SoftPackageReferences"),this.uasset.softPackageReferences.push({assetPathName:this.resolveFName(e)})},e.prototype.readSearchableNames=function(){this.currentIdx=this.uasset.header.SearchableNamesOffset,this.int32("CountSearchableNames"),this.uasset.searchableNames=[]},e.prototype.readThumbnails=function(){var e,t,s,a,i=0,r=0,n="JPEG",h="";for(this.currentIdx=this.uasset.header.ThumbnailTableOffset,t=this.int32("Thumbnails Count"),this.uasset.thumbnails.Index=[],this.uasset.thumbnails.Thumbnails=[];i<t;++i)this.uasset.thumbnails.Index.push({AssetClassName:this.fstring("Thumbnails #"+(i+1)+": assetClassName"),ObjectPathWithoutPackageName:this.fstring("Thumbnails #"+(i+1)+": objectPathWithoutPackageName"),FileOffset:this.int32("Thumbnails #"+(i+1)+": fileOffset")});for(i=0;i<t;++i)this.currentIdx=this.uasset.thumbnails.Index[i].FileOffset,s=this.int32("Thumbnails #"+(i+1)+": imageWidth"),n="PNG",(r=this.int32("Thumbnails #"+(i+1)+": imageHeight"))<0&&(n="JPEG",r*=-1),h="",0<(a=this.int32("Thumbnails #"+(i+1)+": imageSizeData"))&&(e=this.currentIdx,h=this.readCountBytes(a),this.addHexView("Thumbnails #"+(i+1)+": imageData","data",h.join(""),e,this.currentIdx-1)),this.uasset.thumbnails.Thumbnails.push({ImageWidth:s,ImageHeight:r,ImageFormat:n,ImageSizeData:a,ImageData:h})},e.prototype.readAssetRegistryData=function(){var e,t,s=0,a=0,i=this.uasset.header.TotalHeaderSize;for(this.currentIdx=this.uasset.header.AssetRegistryDataOffset,0<this.uasset.header.WorldTileInfoDataOffset&&(i=this.uasset.header.WorldTileInfoDataOffset),this.uasset.assetRegistryData.size=i-this.uasset.header.AssetRegistryDataOffset,this.uasset.assetRegistryData.DependencyDataOffset=this.int64("DependencyDataOffset"),this.uasset.assetRegistryData.data=[],e=this.int32("AssetRegistryData Count"),s=0;s<e;++s)for(this.uasset.assetRegistryData.data.push({ObjectPath:this.fstring("ObjectPath"),ObjectClassName:this.fstring("ObjectClassName"),Tags:[]}),t=this.int32("AssetRegistryData Tag Count"),a=0;a<t;++a)this.uasset.assetRegistryData.data[s].Tags.push({Key:this.fstring("key"),Value:this.fstring("value")})},e.prototype.readPreloadDependency=function(){this.currentIdx=this.uasset.header.PreloadDependencyOffset},e.prototype.readBulkDataStart=function(){this.currentIdx=Number(this.uasset.header.BulkDataStartOffset)},e.prototype.analyze=function(e,t){var s;return this.currentIdx=0,this.bytes=e,this.saveHexView=t||!1,void 0!==(s=this.readHeader())||(this.readNames(),void 0!==(s=this.readGatherableTextData()))?s:(this.readImports(),this.readExports(),this.readDepends(),this.readSoftPackageReferences(),this.readSearchableNames(),this.readThumbnails(),this.readAssetRegistryData(),this.readPreloadDependency(),this.readBulkDataStart(),this.uasset.hexView.sort(function(e,t){return e.start-t.start}),this.uasset)},Object.freeze(e.prototype),Object.freeze(e),window.blueprintUE.uasset.ReaderUasset=e}();